[phases.setup]
nixPkgs = ["dotnet-sdk_9", "nodejs_20"]

[phases.install]
cmds = [
  "npm ci",
  "dotnet restore \"Live Movies.csproj\""
]

[phases.build]
cmds = [
  "npm run build",
  "dotnet publish -c Release -o ./publish"
]

[phases.assemble]
cmds = [
  "mkdir -p ./publish/wwwroot",
  "cp -r dist/* ./publish/wwwroot/ 2>/dev/null || true",
  "mkdir -p ./publish/uploads/movies"
]

[start]
cmd = "cd ./publish && dotnet \"Live Movies.dll\""

[variables]
ASPNETCORE_ENVIRONMENT = "Production"
ASPNETCORE_URLS = "http://*:8080"